<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KhanaGo - Daily Profit Log</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(255, 107, 53, 0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .content { padding: 30px; }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
            transition: transform 0.3s;
            text-align: center;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card h3 {
            font-size: 1em;
            opacity: 0.9;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        .stat-card .amount { 
            font-size: 2.5em; 
            font-weight: bold; 
            margin-bottom: 10px;
        }
        .stat-card .detail { font-size: 0.95em; opacity: 0.85; }
        
        /* Form Section */
        .form-section {
            background: #fff8f3;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #ffe5d9;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        .form-section h2 { 
            color: #ff6b35; 
            margin-bottom: 30px; 
            font-size: 1.8em;
            text-align: center;
        }
        .form-group { 
            margin-bottom: 25px;
        }
        .form-group label { 
            display: block;
            margin-bottom: 10px; 
            color: #333; 
            font-weight: 600;
            font-size: 1.1em;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ffe5d9;
            border-radius: 8px;
            font-size: 1.1em;
            font-family: inherit;
            transition: all 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        .form-group textarea { 
            resize: vertical; 
            min-height: 100px; 
        }
        .profit-input {
            font-size: 1.5em !important;
            font-weight: bold;
            text-align: center;
        }
        
        /* Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }
        .btn-primary:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        .btn-secondary { 
            background: #6c757d; 
            color: white; 
        }
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        /* Table */
        .table-section { margin-top: 40px; }
        .table-section h2 { 
            color: #ff6b35; 
            margin-bottom: 20px; 
            font-size: 1.8em;
            text-align: center;
        }
        .table-actions {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(255, 107, 53, 0.15);
            border: 2px solid #ffe5d9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 800px;
        }
        thead {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
        }
        th { padding: 20px; text-align: left; font-weight: 600; font-size: 1.1em; }
        td { padding: 20px; border-bottom: 1px solid #ffe5d9; font-size: 1.05em; }
        tbody tr:hover { background: #fff8f3; }
        .profit-positive { 
            color: #28a745; 
            font-weight: bold;
            font-size: 1.2em;
        }
        .profit-negative { 
            color: #dc3545; 
            font-weight: bold;
            font-size: 1.2em;
        }
        .btn-small {
            padding: 8px 15px;
            font-size: 0.95em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 8px;
            transition: all 0.3s;
        }
        .btn-small:hover { transform: translateY(-2px); }
        .btn-edit { background: #ffc107; color: #333; }
        .btn-delete { background: #dc3545; color: white; }
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-size: 1.2em;
        }
        .entry-id {
            color: #999;
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
            .form-section { padding: 25px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>KhanaGo Daily Profit Log</h1>
            <p>Track Daily Revenue Streams</p>
        </div>

        <div class="content">
            <!-- Statistics Dashboard -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Profit</h3>
                    <div class="amount" id="totalProfit">₹0.00</div>
                    <div class="detail" id="totalEntries">0 entries logged</div>
                </div>
                <div class="stat-card">
                    <h3>This Month</h3>
                    <div class="amount" id="monthlyProfit">₹0.00</div>
                    <div class="detail" id="monthlyEntries">0 entries</div>
                </div>
                <div class="stat-card">
                    <h3>Average Per Entry</h3>
                    <div class="amount" id="avgProfit">₹0.00</div>
                    <div class="detail">per entry</div>
                </div>
                <div class="stat-card">
                    <h3>Best Entry</h3>
                    <div class="amount" id="bestProfit">₹0.00</div>
                    <div class="detail" id="bestDate">-</div>
                </div>
                <div class="stat-card">
                    <h3>Top Source</h3>
                    <div class="amount" id="topSource">-</div>
                    <div class="detail" id="topSourceAmount">₹0.00</div>
                </div>
            </div>

            <!-- Log Form -->
            <div class="form-section">
                <h2>Log Profit Entry</h2>
                
                <div class="form-group">
                    <label>Date*</label>
                    <input type="date" id="date">
                </div>
                
                <div class="form-group">
                    <label>Source*</label>
                    <select id="source">
                        <option value="">Select Source</option>
                        <option value="Platform Fees">Platform Fees</option>
                        <option value="Delivery Fees">Delivery Fees</option>
                        <option value="Restaurant Commission">Restaurant Commission</option>
                        <option value="Onboarding Fees">Onboarding Fees</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Profit Amount (₹)*</label>
                    <input type="number" id="profit" class="profit-input" step="0.01" placeholder="0.00">
                </div>
                
                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea id="notes" placeholder="Any notes about this entry..."></textarea>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-secondary" id="clearBtn">Clear</button>
                    <button class="btn btn-primary" id="addBtn">Log Profit</button>
                </div>
            </div>

            <!-- Profit History -->
            <div class="table-section">
                <h2>Profit History</h2>
                
                <div class="table-actions">
                    <button class="btn btn-secondary" id="exportBtn">Export CSV</button>
                    <button class="btn btn-secondary" id="clearAllBtn">Clear All</button>
                </div>
                
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Entry ID</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Source</th>
                                <th>Profit/Loss</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tbody">
                            <tr><td colspan="7" class="no-data">No profit logged yet. Start tracking above.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

<script>
let profitLogs = [];
let editIndex = -1;
let nextId = 1;

window.onload = function() {
    document.getElementById('date').value = new Date().toISOString().split('T')[0];
    loadData();
    
    document.getElementById('addBtn').onclick = addLog;
    document.getElementById('clearBtn').onclick = clearForm;
    document.getElementById('exportBtn').onclick = exportToCSV;
    document.getElementById('clearAllBtn').onclick = clearAllData;
};

function loadData() {
    const saved = localStorage.getItem('khanagoProfitLog');
    if(saved) {
        profitLogs = JSON.parse(saved);
        // Calculate next ID
        if(profitLogs.length > 0) {
            const maxId = Math.max(...profitLogs.map(l => l.id || 0));
            nextId = maxId + 1;
        }
        render();
    }
}

function saveData() {
    localStorage.setItem('khanagoProfitLog', JSON.stringify(profitLogs));
}

function addLog() {
    const now = new Date();
    const log = {
        id: editIndex === -1 ? nextId++ : profitLogs[editIndex].id,
        date: document.getElementById('date').value,
        time: now.toTimeString().split(' ')[0].substring(0, 5), // HH:MM format
        timestamp: now.toISOString(),
        source: document.getElementById('source').value,
        profit: parseFloat(document.getElementById('profit').value) || 0,
        notes: document.getElementById('notes').value.trim()
    };
    
    if(!log.date) {
        alert('Please select a date!');
        return;
    }
    
    if(!log.source) {
        alert('Please select a source!');
        return;
    }
    
    if(log.profit === 0) {
        alert('Please enter profit amount!');
        return;
    }
    
    if(editIndex === -1) {
        profitLogs.push(log);
        alert('Profit logged successfully!');
    } else {
        profitLogs[editIndex] = log;
        editIndex = -1;
        document.getElementById('addBtn').textContent = 'Log Profit';
        alert('Entry updated successfully!');
    }
    
    saveData();
    render();
    clearForm();
}

function clearForm() {
    document.getElementById('source').value = '';
    document.getElementById('profit').value = '';
    document.getElementById('notes').value = '';
    document.getElementById('date').value = new Date().toISOString().split('T')[0];
    editIndex = -1;
    document.getElementById('addBtn').textContent = 'Log Profit';
}

function render() {
    const tbody = document.getElementById('tbody');
    if(!profitLogs.length) {
        tbody.innerHTML = '<tr><td colspan="7" class="no-data">No profit logged yet.</td></tr>';
        updateStats();
        return;
    }
    
    // Sort by timestamp descending (newest first)
    const sorted = [...profitLogs].sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));
    
    tbody.innerHTML = sorted.map(log => {
        const idx = profitLogs.indexOf(log);
        const profitClass = log.profit >= 0 ? 'profit-positive' : 'profit-negative';
        const profitSymbol = log.profit >= 0 ? '+' : '';
        
        return `
            <tr>
                <td><span class="entry-id">#${log.id}</span></td>
                <td><b>${log.date}</b></td>
                <td>${log.time}</td>
                <td>${log.source}</td>
                <td class="${profitClass}">${profitSymbol}₹${log.profit.toFixed(2)}</td>
                <td>${log.notes || '-'}</td>
                <td>
                    <button class="btn-small btn-edit" onclick="editLog(${idx})">Edit</button>
                    <button class="btn-small btn-delete" onclick="deleteLog(${idx})">Delete</button>
                </td>
            </tr>
        `;
    }).join('');
    
    updateStats();
}

function editLog(i) {
    const log = profitLogs[i];
    document.getElementById('date').value = log.date;
    document.getElementById('source').value = log.source;
    document.getElementById('profit').value = log.profit;
    document.getElementById('notes').value = log.notes;
    
    editIndex = i;
    document.getElementById('addBtn').textContent = 'Update Entry';
    window.scrollTo(0, 0);
}

function deleteLog(i) {
    if(confirm(`Delete entry #${profitLogs[i].id}?`)) {
        profitLogs.splice(i, 1);
        saveData();
        render();
        alert('Entry deleted!');
    }
}

function updateStats() {
    const total = profitLogs.length;
    
    if(total === 0) {
        document.getElementById('totalProfit').textContent = '₹0.00';
        document.getElementById('totalEntries').textContent = '0 entries logged';
        document.getElementById('monthlyProfit').textContent = '₹0.00';
        document.getElementById('monthlyEntries').textContent = '0 entries';
        document.getElementById('avgProfit').textContent = '₹0.00';
        document.getElementById('bestProfit').textContent = '₹0.00';
        document.getElementById('bestDate').textContent = '-';
        document.getElementById('topSource').textContent = '-';
        document.getElementById('topSourceAmount').textContent = '₹0.00';
        return;
    }
    
    const totalProfit = profitLogs.reduce((s, l) => s + l.profit, 0);
    const avgProfit = totalProfit / total;
    
    document.getElementById('totalProfit').textContent = '₹' + totalProfit.toFixed(2);
    document.getElementById('totalEntries').textContent = total + (total === 1 ? ' entry logged' : ' entries logged');
    document.getElementById('avgProfit').textContent = '₹' + avgProfit.toFixed(2);
    
    // This month
    const now = new Date();
    const thisMonth = profitLogs.filter(l => {
        const d = new Date(l.date);
        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
    });
    const monthlyProfit = thisMonth.reduce((s, l) => s + l.profit, 0);
    
    document.getElementById('monthlyProfit').textContent = '₹' + monthlyProfit.toFixed(2);
    document.getElementById('monthlyEntries').textContent = thisMonth.length + (thisMonth.length === 1 ? ' entry' : ' entries');
    
    // Best entry
    const sorted = [...profitLogs].sort((a, b) => b.profit - a.profit);
    const best = sorted[0];
    
    document.getElementById('bestProfit').textContent = '₹' + best.profit.toFixed(2);
    document.getElementById('bestDate').textContent = best.date + ' ' + best.time;
    
    // Top source
    const sources = {};
    profitLogs.forEach(l => {
        sources[l.source] = (sources[l.source] || 0) + l.profit;
    });
    const topSourceEntry = Object.entries(sources).sort((a, b) => b[1] - a[1])[0];
    if(topSourceEntry) {
        document.getElementById('topSource').textContent = topSourceEntry[0];
        document.getElementById('topSourceAmount').textContent = '₹' + topSourceEntry[1].toFixed(2);
    } else {
        document.getElementById('topSource').textContent = '-';
        document.getElementById('topSourceAmount').textContent = '₹0.00';
    }
}

function exportToCSV() {
    if(!profitLogs.length) {
        alert('No data to export!');
        return;
    }
    
    const headers = ['Entry ID', 'Date', 'Time', 'Source', 'Profit', 'Notes'];
    const csv = [
        headers.join(','),
        ...profitLogs.map(l => [
            l.id,
            l.date,
            l.time,
            l.source,
            l.profit.toFixed(2),
            `"${l.notes}"`
        ].join(','))
    ].join('\n');
    
    const blob = new Blob([csv], {type:'text/csv'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `KhanaGo_Profit_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    alert('Data exported successfully!');
}

function clearAllData() {
    if(confirm('Delete all profit logs? This cannot be undone!')) {
        profitLogs = [];
        nextId = 1;
        saveData();
        render();
        alert('All data cleared!');
    }
}
</script>
</body>
</html>
